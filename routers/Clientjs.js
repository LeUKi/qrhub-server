const router = require('../node_modules/koa-router')()
const Config = require('../VCconfig');
router.get('/client.js', async (ctx, next) => {
    ctx.set('Content-Type', 'application/javascript');
    ctx.body = `var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};function k(){for(var a=document.cookie.split(";"),b=0;b<a.length;b++)if(0==a[b].trim().indexOf("vcc_"+location.host))return!1;a=new Date;a.setTime(a.getTime()+864E5);document.cookie="vcc_"+location.host+"=1; expires="+a.toGMTString();return!0}fetch("${Config.serviceURL}:${Config.truePort}/viewerCatch",{method:"POST",headers:{d:location.host,p:location.pathname,nv:k()}}).then(function(a){return a.json()}).then(function(a){"pv uv like pv_sum uv_sum like_sum path_count".split(" ").forEach(function(b){document.querySelectorAll(".VCC .VCC_"+b+",.VCC.VCC_"+b).forEach(function(c){c.innerHTML=a.data[b]})});document.querySelectorAll(".VCC .VCC_before,.VCC.VCC_before").forEach(function(b){if(b.attributes.vcc_showin){if(b.attributes.vcc_showin.value==location.pathname){b.classList.remove("VCC_before")}}else if(b.attributes.vcc_hidein){if(b.attributes.vcc_hidein.value!=location.pathname){b.classList.remove("VCC_before")}}else{b.classList.remove("VCC_before")}});document.querySelectorAll(".VCC .VCC_giveLike,.VCC.VCC_giveLike").forEach(function(c){c.addEventListener("click",function(){fetch("${Config.serviceURL}:${Config.truePort}/like",{method:"POST",headers:{d:location.host,p:location.pathname,}}).then(function(a){return a.json()}).then(function(f){document.querySelectorAll(".VCC .VCC_like,.VCC.VCC_like").forEach(function(d){d.innerHTML=f.data.like})})})})});`
})
module.exports = router.routes();